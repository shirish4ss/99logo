<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Place Order | 99logo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Base Glass Styles */
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .bg-mesh {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: #0f172a;
            overflow: hidden;
        }
        .blob {
            position: absolute; filter: blur(80px); opacity: 0.6; animation: float 10s infinite alternate;
        }
        .blob-1 { top: -10%; left: -10%; width: 500px; height: 500px; background: #4f46e5; }
        .blob-2 { bottom: -10%; right: -10%; width: 500px; height: 500px; background: #ec4899; animation-delay: -5s; }
        
        @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(50px, 50px); } }

        /* FIXED: New Input Field Styling */
        .input-field {
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 0.75rem;
            padding: 1rem 1.25rem;
            color: white;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            outline: none;
        }
        .input-field:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
            background: rgba(0, 0, 0, 0.6);
        }
        .input-field::placeholder { color: #64748b; }

        /* Radio Card Styling */
        .package-option { display: block; cursor: pointer; position: relative; }
        .package-option input { position: absolute; opacity: 0; }
        .package-card {
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            background: rgba(255,255,255,0.02);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .package-option input:checked + .package-card {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.1);
            transform: translateY(-4px);
        }
        .check-icon {
            width: 24px; height: 24px; border-radius: 50%; background: rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: transparent; position: absolute; top: 1rem; right: 1rem;
            transition: all 0.2s;
        }
        .package-option input:checked + .package-card .check-icon {
            background: #6366f1; color: white;
        }
        .package-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; }

        /* Modal */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 100;
            display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px);
        }
        .modal-overlay.active { display: flex; }
        
        .text-gradient-primary {
            background: linear-gradient(to right, #818cf8, #c084fc);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="text-white antialiased font-sans">

    <!-- Background -->
    <div class="bg-mesh">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <div class="min-h-screen py-10 px-4 flex items-center justify-center">
        <!-- Main Form Container -->
        <div class="glass max-w-5xl w-full p-8 md:p-12 rounded-3xl relative shadow-2xl">
            <a href="index.html" class="absolute top-6 right-6 text-gray-400 hover:text-white transition text-2xl z-10">&times;</a>
            
            <div class="mb-10 text-center">
                <h2 class="text-3xl md:text-5xl font-bold mb-3">Detailed <span class="text-gradient-primary">Design Brief</span></h2>
                <p class="text-slate-400 text-sm md:text-base">Tell us about your vision. We'll handle the pixel perfection.</p>
            </div>

            <form id="orderForm" class="space-y-10">
                
                <!-- Section 1: Client Info -->
                <div class="space-y-6">
                    <div class="flex items-center gap-3 text-indigo-400 mb-4 border-b border-white/10 pb-3">
                        <div class="w-8 h-8 rounded-lg bg-indigo-500/20 flex items-center justify-center">
                            <i class="fas fa-user text-sm"></i>
                        </div>
                        <h3 class="font-bold text-lg tracking-wide uppercase">1. Client Details</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="group">
                            <label class="text-xs text-indigo-300 font-bold ml-1 mb-2 block uppercase tracking-wider">Your Name</label>
                            <input type="text" name="clientName" required placeholder="John Doe" class="input-field">
                        </div>
                        <div class="group">
                            <label class="text-xs text-indigo-300 font-bold ml-1 mb-2 block uppercase tracking-wider">WhatsApp / Mobile</label>
                            <input type="tel" name="contact" required placeholder="+91 98765 43210" class="input-field">
                        </div>
                        <div class="md:col-span-2 group">
                             <label class="text-xs text-indigo-300 font-bold ml-1 mb-2 block uppercase tracking-wider">Account Email</label>
                             <input type="email" name="userEmail" required placeholder="you@example.com" class="input-field">
                        </div>
                        <div class="md:col-span-2 group">
                             <label class="text-xs text-indigo-300 font-bold ml-1 mb-2 block uppercase tracking-wider">Create Password</label>
                             <input type="password" name="userPass" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="input-field">
                        </div>
                    </div>
                </div>

                <!-- Section 2: Business Info -->
                <div class="space-y-6">
                    <div class="flex items-center gap-3 text-pink-400 mb-4 border-b border-white/10 pb-3">
                        <div class="w-8 h-8 rounded-lg bg-pink-500/20 flex items-center justify-center">
                            <i class="fas fa-briefcase text-sm"></i>
                        </div>
                        <h3 class="font-bold text-lg tracking-wide uppercase">2. Brand Information</h3>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="text-xs text-pink-300 font-bold ml-1 mb-2 block uppercase tracking-wider">Brand Name</label>
                            <input type="text" name="brandName" required placeholder="99logo" class="input-field">
                        </div>
                        <div>
                            <label class="text-xs text-pink-300 font-bold ml-1 mb-2 block uppercase tracking-wider">Tagline (Optional)</label>
                            <input type="text" name="tagline" placeholder="Visionary Design" class="input-field">
                        </div>
                        <div>
                            <label class="text-xs text-pink-300 font-bold ml-1 mb-2 block uppercase tracking-wider">Industry / Niche</label>
                            <input type="text" name="niche" required placeholder="E-Commerce, Finance, Healthcare..." class="input-field">
                        </div>
                        <div>
                            <label class="text-xs text-pink-300 font-bold ml-1 mb-2 block uppercase tracking-wider">Target Audience</label>
                            <input type="text" name="audience" placeholder="Gen-Z, Professionals, Startups..." class="input-field">
                        </div>
                    </div>
                </div>

                <!-- Section 3: Design Preferences -->
                <div class="space-y-6">
                    <div class="flex items-center gap-3 text-purple-400 mb-4 border-b border-white/10 pb-3">
                        <div class="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center">
                            <i class="fas fa-palette text-sm"></i>
                        </div>
                        <h3 class="font-bold text-lg tracking-wide uppercase">3. Design Preferences</h3>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="text-xs text-purple-300 font-bold ml-1 mb-2 block uppercase tracking-wider">Preferred Colors (Optional)</label>
                            <input type="text" name="colors" placeholder="Blue, Gold, Black..." class="input-field">
                        </div>
                        <div>
                            <label class="text-xs text-purple-300 font-bold ml-1 mb-3 block uppercase tracking-wider">Desired Vibe</label>
                            <div class="package-grid">
                                <label class="package-option">
                                    <input type="radio" name="vibe" value="Modern" required>
                                    <div class="package-card">
                                        <span class="check-icon"><i class="fas fa-check"></i></span>
                                        <div class="text-2xl mb-2">üî•</div>
                                        <p class="font-bold text-sm">Modern</p>
                                    </div>
                                </label>
                                <label class="package-option">
                                    <input type="radio" name="vibe" value="Minimalist">
                                    <div class="package-card">
                                        <span class="check-icon"><i class="fas fa-check"></i></span>
                                        <div class="text-2xl mb-2">‚ú®</div>
                                        <p class="font-bold text-sm">Minimalist</p>
                                    </div>
                                </label>
                                <label class="package-option">
                                    <input type="radio" name="vibe" value="Bold">
                                    <div class="package-card">
                                        <span class="check-icon"><i class="fas fa-check"></i></span>
                                        <div class="text-2xl mb-2">üí•</div>
                                        <p class="font-bold text-sm">Bold</p>
                                    </div>
                                </label>
                                <label class="package-option">
                                    <input type="radio" name="vibe" value="Elegant">
                                    <div class="package-card">
                                        <span class="check-icon"><i class="fas fa-check"></i></span>
                                        <div class="text-2xl mb-2">üëë</div>
                                        <p class="font-bold text-sm">Elegant</p>
                                    </div>
                                </label>
                                <label class="package-option">
                                    <input type="radio" name="vibe" value="Playful">
                                    <div class="package-card">
                                        <span class="check-icon"><i class="fas fa-check"></i></span>
                                        <div class="text-2xl mb-2">üé®</div>
                                        <p class="font-bold text-sm">Playful</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="text-xs text-purple-300 font-bold ml-1 mb-2 block uppercase tracking-wider">Additional Ideas / Notes</label>
                            <textarea id="ideasInput" name="ideas" maxlength="300" rows="4" placeholder="Any references, style notes, or inspirations..." class="input-field resize-none"></textarea>
                            <p class="text-xs text-right text-gray-500 mt-1" id="charCount">0/300</p>
                        </div>
                    </div>
                </div>

                <!-- Section 4: Packages -->
                <div class="space-y-6">
                    <div class="flex items-center gap-3 text-cyan-400 mb-4 border-b border-white/10 pb-3">
                        <div class="w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                            <i class="fas fa-box text-sm"></i>
                        </div>
                        <h3 class="font-bold text-lg tracking-wide uppercase">4. Select Package</h3>
                    </div>
                    <div class="package-grid">
                        <label class="package-option">
                            <input type="radio" name="packageType" value="Basic" data-price="99" required checked>
                            <div class="package-card">
                                <span class="check-icon"><i class="fas fa-check"></i></span>
                                <div class="text-2xl mb-2">üíé</div>
                                <p class="font-bold">Basic</p>
                                <p class="text-xs text-gray-400 mt-1">2 Options</p>
                                <p class="text-xs text-green-400 font-bold mt-1">‚Çπ99</p>
                            </div>
                        </label>
                        <label class="package-option">
                            <input type="radio" name="packageType" value="Standard" data-price="150">
                            <div class="package-card">
                                <span class="check-icon"><i class="fas fa-check"></i></span>
                                <div class="text-2xl mb-2">üíé</div>
                                <p class="font-bold text-sm">Standard</p>
                                <p class="text-xs text-gray-400 mt-1">4 Options</p>
                                <p class="text-xs text-green-400 font-bold mt-1">‚Çπ150</p>
                            </div>
                        </label>
                        <label class="package-option">
                            <input type="radio" name="packageType" value="Premium" data-price="200">
                            <div class="package-card">
                                <span class="check-icon"><i class="fas fa-check"></i></span>
                                <div class="text-2xl mb-2">üíé</div>
                                <p class="font-bold text-sm">Premium</p>
                                <p class="text-xs text-gray-400 mt-1">8 Options</p>
                                <p class="text-xs text-green-400 font-bold mt-1">‚Çπ200</p>
                            </div>
                        </label>
                    </div>

                    <div>
                        <label class="text-xs text-cyan-300 font-bold ml-1 mb-3 block uppercase tracking-wider">Add-ons (Optional)</label>
                        <div class="space-y-3">
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" name="addon" value="100" class="w-5 h-5 accent-cyan-500">
                                <span class="text-sm">Social Media Kit <span class="text-cyan-400 font-bold">+‚Çπ100</span></span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" name="addon" value="50" class="w-5 h-5 accent-cyan-500">
                                <span class="text-sm">Visiting Card <span class="text-cyan-400 font-bold">+‚Çπ50</span></span>
                            </label>
                            <label class="flex items-center gap-3 cursor-pointer">
                                <input type="checkbox" name="addon" value="100" data-express="true" class="w-5 h-5 accent-cyan-500">
                                <span class="text-sm">Express Delivery (5 Hours) <span class="text-cyan-400 font-bold">+‚Çπ100</span></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Section 5: Summary -->
                <div class="glass p-6 rounded-2xl border border-indigo-500/30">
                    <h3 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-receipt text-indigo-400"></i> Order Summary
                    </h3>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">Selected Package:</span>
                            <span id="summaryPackage" class="font-bold text-white">Basic</span>
                        </div>
                        <hr class="border-white/10">
                        <p class="text-xs text-gray-400 uppercase">Total Payable</p>
                        <p id="summaryPrice" class="text-2xl font-bold text-green-400">‚Çπ99</p>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="pt-2">
                    <button type="button" onclick="openPayment()" class="w-full py-5 rounded-xl font-bold text-xl bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white shadow-2xl shadow-indigo-500/30 flex items-center justify-center gap-3 group transition-all transform hover:scale-[1.01]">
                        Proceed to Payment <i class="fas fa-arrow-right group-hover:translate-x-1 transition"></i>
                    </button>
                    <p class="text-center text-xs text-gray-500 mt-4"><i class="fas fa-lock text-gray-600"></i> Your data is encrypted and secure.</p>
                </div>
            </form>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal-overlay" id="paymentModal">
        <div class="glass p-8 rounded-3xl text-center max-w-sm w-full relative m-4 border border-white/20">
            <button onclick="closeModal()" class="absolute top-4 right-5 text-gray-400 hover:text-white transition text-xl">&times;</button>
            
            <div class="w-16 h-16 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-4 text-green-400 text-2xl border border-green-500/20">
                <i class="fas fa-shield-alt"></i>
            </div>
            
            <h3 class="text-2xl font-bold mb-1">Secure Checkout</h3>
            <p class="mb-6 text-sm text-slate-400">Scan via Any UPI App</p>
            
            <div class="bg-white p-3 rounded-2xl inline-block mb-4 shadow-lg mx-auto">
                <img id="qrImage" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=yourupi@okaxis&pn=99logo&am=150" class="w-40 h-40 object-contain">
            </div>
            
            <div class="text-3xl font-bold text-white mb-6">
                <span class="text-sm text-gray-400 align-middle">Total:</span> <span id="payAmount" class="text-green-400">‚Çπ150</span>
            </div>
            
            <div class="text-left mb-6">
                <label class="text-xs text-slate-400 uppercase font-bold ml-1">Paste Transaction ID (UTR)</label>
                <input type="text" id="userTxId" placeholder="e.g. 403819XXXXXX" class="w-full bg-black/40 border border-gray-600 rounded-lg px-4 py-3 mt-2 text-white focus:border-green-500 outline-none">
            </div>
            
            <button onclick="confirmOrder()" class="w-full py-4 bg-green-600 hover:bg-green-500 rounded-xl font-bold transition shadow-lg shadow-green-900/50">Confirm Payment</button>
        </div>
    </div>

    <!-- Load Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ============================================
        // SUPABASE CONFIGURATION
        // ============================================
        const SUPABASE_URL = 'https://xwqitpteemdvrycpcxgo.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh3cWl0cHRlZW1kdnJ5Y3BjeGdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3MDAzMDgsImV4cCI6MjA4NTI3NjMwOH0.ZEn9riWkZn-WW0wtH01AiujJH5EJmfps90oHVsRVeBI';

        let supabaseClient;

        try {
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('‚úÖ Supabase initialized');
        } catch (error) {
            console.error('‚ùå Supabase init failed:', error);
        }

        // FIXED: Character Counter Logic
        const ideasInput = document.getElementById('ideasInput');
        const charCount = document.getElementById('charCount');
        ideasInput.addEventListener('input', () => {
            charCount.innerText = `${ideasInput.value.length}/300`;
            if(ideasInput.value.length >= 300) charCount.classList.add('text-red-500');
            else charCount.classList.remove('text-red-500');
        });

        // FIXED: Live Pricing Logic (Includes Addons)
        function updatePrice() {
            const selectedPackage = document.querySelector('input[name="packageType"]:checked');
            const basePrice = parseInt(selectedPackage.dataset.price);
            
            let addonsPrice = 0;
            document.querySelectorAll('input[name="addon"]:checked').forEach(addon => {
                addonsPrice += parseInt(addon.value);
            });

            const total = basePrice + addonsPrice;

            // Update Summaries
            document.getElementById('summaryPrice').innerText = '‚Çπ' + total;
            document.getElementById('payAmount').innerText = '‚Çπ' + total;
            document.getElementById('summaryPackage').innerText = selectedPackage.value;
            
            // Update QR Code
            const qrImg = document.getElementById('qrImage');
            qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay?pa=yourupi@okaxis&pn=99logo&am=${total}`;
        }

        // Listen for changes on Package and Addons
        document.querySelectorAll('input[name="packageType"], input[name="addon"]').forEach(el => {
            el.addEventListener('change', updatePrice);
        });

        // Modal Logic
        function openPayment() {
            const form = document.getElementById('orderForm');
            if(form.checkValidity()) {
                document.getElementById('paymentModal').classList.add('active');
            } else {
                form.reportValidity();
            }
        }

        function closeModal() {
            document.getElementById('paymentModal').classList.remove('active');
        }

        // ============================================
        // FIXED: SAVE TO SUPABASE DATABASE
        // ============================================
        async function confirmOrder() {
            const txId = document.getElementById('userTxId').value.trim();
            if(!txId) { 
                alert("‚ö†Ô∏è Please enter Transaction ID"); 
                document.getElementById('userTxId').focus();
                return; 
            }
            
            const form = document.getElementById('orderForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            // Show loading
            const btn = document.querySelector('button[onclick="confirmOrder()"]');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving to Database...';

            try {
                // 1. Generate Order Number
                const orderNumber = "#" + Math.floor(100 + Math.random() * 900);
                const timestamp = Date.now();

                // 2. SAVE USER TO SUPABASE (SO THEY CAN LOGIN!)
                console.log('Saving user to database...');
                const userResult = await supabaseClient
                    .from('users')
                    .upsert([{
                        email: data.userEmail,
                        password: data.userPass,
                        name: data.clientName,
                        role: 'client'
                    }], { 
                        onConflict: 'email',
                        ignoreDuplicates: false 
                    })
                    .select();

                if (userResult.error) {
                    console.error('User save error:', userResult.error);
                    throw new Error('Failed to save user: ' + userResult.error.message);
                }
                console.log('‚úÖ User saved successfully');

                // 3. Get selected addons
                const selectedAddons = [];
                document.querySelectorAll('input[name="addon"]:checked').forEach(addon => {
                    const label = addon.parentElement.textContent.trim();
                    selectedAddons.push(label);
                });

                // 4. SAVE ORDER TO SUPABASE
                console.log('Saving order to database...');
                const orderResult = await supabaseClient
                    .from('orders')
                    .insert([{
                        order_number: orderNumber,
                        client_name: data.clientName,
                        contact: data.contact,
                        user_email: data.userEmail,
                        brand_name: data.brandName,
                        tagline: data.tagline || '',
                        niche: data.niche,
                        audience: data.audience || '',
                        colors: data.colors || '',
                        vibe: data.vibe,
                        ideas: data.ideas || '',
                        package_type: data.packageType,
                        addons: selectedAddons.join(', '),
                        tx_id: txId,
                        status: 'Unconfirmed',
                        date: new Date().toLocaleDateString(),
                        timestamp: timestamp
                    }])
                    .select();

                if (orderResult.error) {
                    console.error('Order save error:', orderResult.error);
                    throw new Error('Failed to save order: ' + orderResult.error.message);
                }
                console.log('‚úÖ Order saved successfully');

                // 5. ALSO SAVE TO LOCALSTORAGE (BACKUP)
                const newOrder = {
                    ...data,
                    id: orderNumber,
                    txId: txId,
                    status: "Unconfirmed",
                    date: new Date().toLocaleDateString(),
                    timestamp: timestamp
                };

                let orders = JSON.parse(localStorage.getItem('pixel_orders') || '[]');
                orders.push(newOrder);
                localStorage.setItem('pixel_orders', JSON.stringify(orders));

                let users = JSON.parse(localStorage.getItem('pixel_users') || '[]');
                if(!users.find(u => u.email === data.userEmail)) {
                    users.push({
                        email: data.userEmail,
                        password: data.userPass,
                        name: data.clientName,
                        role: 'client'
                    });
                    localStorage.setItem('pixel_users', JSON.stringify(users));
                }

                // Success!
                setTimeout(() => {
                    alert("‚úÖ Order Placed Successfully!\n\n" + 
                          "üîë Login Credentials:\n" +
                          "Email: " + data.userEmail + "\n" +
                          "Password: " + data.userPass + "\n\n" +
                          "Your order will be visible in the dashboard after Admin confirms your payment (1-2 hours).");
                    window.location.href = "login.html";
                }, 500);

            } catch (error) {
                console.error('‚ùå Error:', error);
                alert("‚ùå Error: " + error.message + "\n\nPlease try again or contact support.");
                
                // Reset button
                btn.disabled = false;
                btn.innerHTML = 'Confirm Payment';
            }
        }
    </script>
</body>
</html>
